name: Random Key & Secret Generator Demo

on:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  generate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      # 1️⃣ Generate RSA Key
      - name: Generate RSA 2048 Key
        run: |
          mkdir -p output
          openssl genpkey -algorithm RSA -out output/rsa_private.pem -pkeyopt rsa_keygen_bits:2048
          openssl rsa -pubout -in output/rsa_private.pem -out output/rsa_public.pem
          echo "RSA key generated"

      # 2️⃣ Generate EC Key
      - name: Generate EC P-256 Key
        run: |
          openssl ecparam -name prime256v1 -genkey -noout -out output/ec_private.pem
          openssl ec -in output/ec_private.pem -pubout -out output/ec_public.pem
          echo "EC key generated"

      # 3️⃣ Generate Random Symmetric Key (256-bit)
      - name: Generate Symmetric AES Key
        run: |
          openssl rand -hex 32 > output/aes_key.hex
          echo "AES key generated"

      # 4️⃣ Generate Random API Key
      - name: Generate API Key
        run: |
          API_KEY=$(openssl rand -base64 32 | tr -d '\n')
          echo "::add-mask::$API_KEY"
          echo "$API_KEY" > output/api_key.txt
          echo "API key generated (masked)"

      # 5️⃣ Generate Random Password
      - name: Generate Random Password
        run: |
          PASSWORD=$(openssl rand -base64 18 | tr -d '\n')
          echo "::add-mask::$PASSWORD"
          echo "$PASSWORD" > output/password.txt
          echo "Password generated (masked)"

      # 6️⃣ Generate HMAC Secret
      - name: Generate HMAC Secret
        run: |
          openssl rand -hex 64 > output/hmac_secret.hex
          echo "HMAC secret generated"

      # 7️⃣ Generate JWT Secret
      - name: Generate JWT Signing Secret
        run: |
          JWT_SECRET=$(openssl rand -base64 48 | tr -d '\n')
          echo "::add-mask::$JWT_SECRET"
          echo "$JWT_SECRET" > output/jwt_secret.txt
          echo "JWT secret generated (masked)"

      # 8️⃣ Demonstrate Using a Secret Securely
      - name: Example usage (masked output)
        run: |
          SECRET=$(cat output/api_key.txt)
          echo "::add-mask::$SECRET"
          echo "Using API key safely without printing it."

      # 9️⃣ Upload All Generated Keys
      - name: Upload Generated Keys & Secrets
        uses: actions/upload-artifact@v4
        with:
          name: generated-crypto-material
          path: output/
